<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Teacher Dashboard - AccountrixTeam</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/progress-tracker.css">
    <link rel="stylesheet" href="/teacher-dashboard.css">
    <style>
        /* Mobile touch fixes */
        * {
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }
        
        button, a, input, select, textarea, .class-card, .team-card, .card, .sidebar nav a {
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
            cursor: pointer;
            pointer-events: auto;
        }
        
        input, textarea {
            user-select: text;
            -webkit-user-select: text;
        }
        
        @media (max-width: 768px) {
            body {
                overflow-x: hidden;
            }
            
            button, a, input, select, .class-card, .team-card, .card, .sidebar nav a, .mobile-menu-toggle {
                min-height: 44px;
                min-width: 44px;
            }
            
            /* Ensure header and all its elements are clickable */
            .header {
                position: relative;
                z-index: 1000;
                pointer-events: auto;
            }
            
            .header * {
                pointer-events: auto;
            }
            
            /* Ensure all buttons and interactive elements are clickable */
            .btn, button, .class-card, .team-card, .card, a {
                pointer-events: auto;
                position: relative;
                z-index: 1;
            }
            
            /* Ensure modals are clickable */
            .modal {
                z-index: 10000;
                pointer-events: auto;
            }
            
            .modal-content {
                position: relative;
                z-index: 10001;
                pointer-events: auto;
            }
            
            /* Hide sidebar on mobile by default */
            .sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                height: 100vh;
                z-index: 9999;
                transition: left 0.3s ease;
                box-shadow: 2px 0 10px rgba(0,0,0,0.1);
                background: var(--dark-bg);
                width: 280px;
                max-width: 80vw;
                pointer-events: auto;
            }
            
            .sidebar.mobile-open {
                left: 0;
                pointer-events: auto;
            }
            
            .sidebar * {
                pointer-events: auto;
            }
            
            .sidebar-overlay {
                z-index: 9998;
                pointer-events: auto;
            }
            
            .mobile-menu-toggle {
                z-index: 10002;
                pointer-events: auto;
                display: flex !important;
            }
            
            .main-content {
                width: 100%;
            }
        }
        .class-card {
            transition: all 0.3s;
        }
        
        .class-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .class-card.expired {
            opacity: 0.6;
            border: 2px solid #ef4444;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .badge-danger {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .badge-warning {
            background: #fef3c7;
            color: #d97706;
        }
        
        .badge-success {
            background: #d1fae5;
            color: #047857;
        }
        
        .badge-secondary {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .team-card {
            transition: all 0.3s;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 2rem;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #6b7280;
            transition: color 0.3s;
        }
        
        .close-btn:hover {
            color: #ef4444;
        }

        /* Mobile Menu Toggle - hidden on desktop */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 10002;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            pointer-events: auto;
            touch-action: manipulation;
        }
        
        @media (min-width: 769px) {
            .mobile-menu-toggle {
                display: none !important;
            }
            
            .sidebar-overlay {
                display: none !important;
            }
            
            /* Reset sidebar to normal positioning on desktop - MUST override mobile styles */
            .sidebar {
                position: relative !important;
                left: auto !important;
                width: 280px !important;
                height: auto !important;
                max-width: none !important;
                box-shadow: none !important;
                background: var(--dark-bg) !important;
                transition: none !important;
            }
            
            .sidebar.mobile-open {
                left: auto !important;
            }
            
            .main-content {
                width: auto !important;
                flex: 1 !important;
            }
            
            /* Reset header styling on desktop */
            .header {
                position: relative !important;
                z-index: auto !important;
                flex-direction: row !important;
                align-items: center !important;
            }
            
            /* Ensure buttons work normally on desktop */
            .btn, button, .class-card, .team-card, .card, a {
                position: relative !important;
                z-index: auto !important;
            }
            
            /* Ensure dashboard uses row layout on desktop */
            .dashboard {
                flex-direction: row !important;
            }
        }

        .mobile-menu-toggle:hover {
            transform: scale(1.1);
        }

        .mobile-menu-toggle i {
            font-size: 24px;
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 998;
        }

        .sidebar-overlay.active {
            display: block;
        }

        /* Responsive Design - Mobile First */
        
        /* Mobile devices (up to 600px) */
        @media (max-width: 600px) {
            body {
                font-size: 14px;
            }

            .mobile-menu-toggle {
                display: flex !important;
            }

            .dashboard {
                flex-direction: column;
            }

            .sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                width: 280px;
                max-width: 80vw;
                height: 100vh;
                z-index: 9999;
                transition: left 0.3s ease;
                box-shadow: 2px 0 10px rgba(0,0,0,0.1);
                pointer-events: auto;
            }

            .sidebar.mobile-open {
                left: 0;
                pointer-events: auto;
            }
            
            .sidebar * {
                pointer-events: auto;
            }

            .sidebar h2 {
                font-size: 20px;
            }

            .sidebar .user-info {
                padding-bottom: 16px;
                margin-bottom: 20px;
            }

            .sidebar nav a {
                padding: 12px 14px;
                font-size: 0.95rem;
            }

            .main-content {
                width: 100%;
                padding: 16px;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
                margin-bottom: 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .btn-small {
                width: 100%;
            }

            .cards-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .card {
                padding: 16px;
            }

            .class-card {
                padding: 18px;
            }

            .team-card {
                padding: 16px;
            }

            .modal-content {
                max-width: 95%;
                padding: 1.5rem;
                margin: 16px;
            }

            .modal-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .modal-header h2 {
                font-size: 1.35rem;
            }

            .close-btn {
                position: absolute;
                right: 1.5rem;
                top: 1.5rem;
            }

            .form-group {
                margin-bottom: 16px;
            }

            .form-group label {
                font-size: 14px;
                margin-bottom: 6px;
            }

            .form-group input,
            .form-group select,
            .form-group textarea {
                padding: 12px 14px;
                font-size: 16px;
            }

            .badge {
                font-size: 11px;
                padding: 3px 7px;
            }

            #classDetailsSection .header {
                padding: 0;
            }

            #classDetailsName {
                font-size: 1.35rem;
            }

            .progress-tracker {
                padding: 16px;
            }
        }

        /* Tablet devices (601px to 1024px) */
        @media (min-width: 601px) and (max-width: 1024px) {
            .dashboard {
                flex-direction: row;
            }

            .sidebar {
                position: relative !important;
                left: auto !important;
                width: 220px;
                padding: 24px 16px;
                height: auto;
                max-width: none;
                box-shadow: none;
            }
            
            .main-content {
                width: auto;
                flex: 1;
            }

            .sidebar h2 {
                font-size: 22px;
            }

            .main-content {
                padding: 24px;
            }

            .header h1 {
                font-size: 28px;
            }

            .cards-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 18px;
            }

            .card {
                padding: 20px;
            }

            .modal-content {
                max-width: 85%;
                padding: 28px;
            }
        }

        /* Laptop/Small Desktop (1025px to 1366px) */
        @media (min-width: 1025px) and (max-width: 1366px) {
            .sidebar {
                position: relative !important;
                left: auto !important;
                width: 260px;
                padding: 30px 20px;
                height: auto;
                max-width: none;
                box-shadow: none;
            }

            .main-content {
                width: auto;
                flex: 1;
                padding: 30px;
            }

            .cards-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }

            .modal-content {
                max-width: 850px;
            }
        }

        /* Large Desktop (1367px and above) */
        @media (min-width: 1367px) {
            .sidebar {
                position: relative !important;
                left: auto !important;
                width: 280px;
                height: auto;
                max-width: none;
                box-shadow: none;
            }

            .main-content {
                width: auto;
                flex: 1;
                padding: 30px 40px;
            }

            .cards-grid {
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            }

            .modal-content {
                max-width: 900px;
            }
        }

        /* Touch devices */
        @media (hover: none) and (pointer: coarse) {
            .btn,
            .btn-small,
            .class-card,
            .team-card {
                min-height: 44px;
            }

            .class-card:hover,
            .team-card:hover {
                transform: none;
            }

            .class-card:active,
            .team-card:active {
                transform: scale(0.98);
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    
    <!-- Mobile Menu Toggle Button -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Old sidebar for user info/logout (keep for now, will be moved to header later) -->
    <aside class="sidebar" id="teacherSidebar" style="display: none;">
        <div class="user-info">
            <h2 id="userName">Teacher</h2>
            <p id="userEmail">email@example.com</p>
        </div>
        <button class="btn btn-logout" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>
    </aside>

    <!-- New Header -->
    <header class="tdb-header">
        <div class="tdb-header-left">
            <div class="tdb-breadcrumb" id="tdbBreadcrumb">
                <a href="#" onclick="backToOverview(); return false;">Classes</a>
                <span id="tdbBreadcrumbSeparator" style="display: none;">/</span>
                <span id="tdbBreadcrumbClass" style="display: none;"></span>
            </div>
            <h1 class="tdb-header-title" id="tdbHeaderTitle">Teacher Dashboard</h1>
        </div>
        <div class="tdb-header-center">
            <i class="fas fa-search tdb-search-icon"></i>
            <input type="search" class="tdb-search" id="tdbSearch" placeholder="Search teams, tasks..." aria-label="Search">
        </div>
        <div class="tdb-header-right">
            <button class="tdb-btn tdb-btn-secondary tdb-btn-small" onclick="toggleChatSlideOver()" id="chatToggleBtn" aria-label="Open Chat" title="Open Chat (C)">
                <i class="fas fa-comments"></i> <span class="tdb-btn-text">Chat</span>
            </button>
            <button class="tdb-btn tdb-btn-primary tdb-btn-small" onclick="openModal('createClassModal')" id="tdbNewClassBtn">
                <i class="fas fa-plus"></i> <span class="tdb-btn-text">New Class</span>
            </button>
            <button class="tdb-btn tdb-btn-primary tdb-btn-small" onclick="openCreateTeamModal()" id="tdbNewTeamBtn" style="display: none;">
                <i class="fas fa-users"></i> <span class="tdb-btn-text">New Team</span>
            </button>
            <button class="tdb-btn tdb-btn-secondary tdb-btn-small" onclick="logout()" aria-label="Logout">
                <i class="fas fa-sign-out-alt"></i> <span class="tdb-btn-text">Logout</span>
            </button>
        </div>
    </header>

    <!-- Quick Jump Strip -->
    <div class="quick-jump-strip" id="quickJumpStrip">
        <button class="quick-jump-btn" onclick="scrollToSection('overviewSection')" data-section="overview">
            <i class="fas fa-home"></i> <span>Overview</span>
        </button>
        <button class="quick-jump-btn" onclick="scrollToSection('classTeamsContainer')" data-section="teams">
            <i class="fas fa-users"></i> <span>Teams</span>
        </button>
        <button class="quick-jump-btn" onclick="toggleChatSlideOver()" data-section="chat">
            <i class="fas fa-comments"></i> <span>Chat</span>
        </button>
        <button class="quick-jump-btn" onclick="scrollToTab('files')" data-section="files">
            <i class="fas fa-folder"></i> <span>Files</span>
        </button>
        <button class="quick-jump-btn" onclick="scrollToTab('submissions')" data-section="submissions">
            <i class="fas fa-file-upload"></i> <span>Submissions</span>
        </button>
    </div>

    <!-- Main Shell -->
    <div class="tdb-shell">
        <main class="tdb-main">
            <!-- Overview Section -->
            <section id="overviewSection">
                <h2 class="tdb-section-title">Your Classes</h2>
                <div id="classesGrid" class="tdb-overview-grid"></div>
            </section>
            
            <!-- Class Details Section -->
            <section id="classDetailsSection" style="display: none;">
                <!-- Class Overview Metrics -->
                <div class="tdb-card">
                    <h2 class="tdb-section-title" id="classDetailsName">Class Name</h2>
                    <p style="color: #6b7280; margin: 8px 0 16px 0;" id="classDetailsDescription">Class description</p>
                    <div id="classOverviewMetrics" class="tdb-overview-grid"></div>
                </div>

                <!-- Progress Tracker -->
                <div class="tdb-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h2 class="tdb-section-title" style="margin: 0;">AI Progress Tracking</h2>
                        <button class="tdb-btn tdb-btn-secondary tdb-btn-small" onclick="refreshProgress()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    <div id="progressTrackerContainer"></div>
                </div>

                <!-- Teams List -->
                <div class="tdb-card">
                    <h2 class="tdb-section-title">Teams in this Class</h2>
                    <div id="classTeamsContainer"></div>
                </div>

                <!-- Selected Team Panel -->
                <div class="tdb-team-panel" id="selectedTeamPanel">
                    <h2 class="tdb-section-title" id="selectedTeamName">Team Name</h2>
                    <div class="tdb-tabs" role="tablist">
                        <button class="tdb-tab" role="tab" aria-selected="true" aria-controls="tab-members" id="tab-btn-members" onclick="switchTab('members')">
                            <i class="fas fa-users"></i> Members
                        </button>
                        <button class="tdb-tab" role="tab" aria-selected="false" aria-controls="tab-tasks" id="tab-btn-tasks" onclick="switchTab('tasks')">
                            <i class="fas fa-tasks"></i> Tasks
                        </button>
                        <button class="tdb-tab" role="tab" aria-selected="false" aria-controls="tab-submissions" id="tab-btn-submissions" onclick="switchTab('submissions')">
                            <i class="fas fa-file-upload"></i> Submissions
                        </button>
                        <button class="tdb-tab" role="tab" aria-selected="false" aria-controls="tab-files" id="tab-btn-files" onclick="switchTab('files')">
                            <i class="fas fa-folder"></i> Files
                        </button>
                    </div>
                    <div class="tdb-tab-content">
                        <div class="tdb-tab-panel" id="tab-members" aria-hidden="false">
                            <div id="selectedTeamMembersList"></div>
                            <form id="addMemberFormInline" style="display: flex; gap: 12px; margin-top: 16px;">
                                <input type="email" id="memberEmailInline" placeholder="Student email" class="tdb-search" style="flex: 1;" required>
                                <button type="submit" class="tdb-btn tdb-btn-primary tdb-btn-small">
                                    <i class="fas fa-plus"></i> Add Student
                                </button>
                            </form>
                        </div>
                        <div class="tdb-tab-panel" id="tab-tasks" aria-hidden="true">
                            <div id="selectedTeamTasksList"></div>
                            <button class="tdb-btn tdb-btn-primary tdb-btn-small" onclick="showCreateTaskForm()" style="margin-top: 16px;">
                                <i class="fas fa-plus"></i> Add Task
                            </button>
                            <div id="createTaskFormContainer" style="display: none; margin-top: 20px; padding: 20px; background: #f9fafb; border-radius: 8px;">
                                <h4>Create New Task</h4>
                                <form id="createTaskForm">
                                    <div class="form-group">
                                        <label for="taskTitle">Task Title *</label>
                                        <input type="text" id="taskTitle" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="taskDescription">Description</label>
                                        <textarea id="taskDescription" rows="3"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="taskDueDate">Due Date</label>
                                        <input type="date" id="taskDueDate">
                                    </div>
                                    <div class="form-group">
                                        <label for="taskAssignedTo">Assign To (Optional)</label>
                                        <select id="taskAssignedTo">
                                            <option value="">All team members</option>
                                        </select>
                                    </div>
                                    <div style="display: flex; gap: 12px;">
                                        <button type="submit" class="tdb-btn tdb-btn-primary tdb-btn-small">
                                            <i class="fas fa-check"></i> Create Task
                                        </button>
                                        <button type="button" class="tdb-btn tdb-btn-secondary tdb-btn-small" onclick="hideCreateTaskForm()">Cancel</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="tdb-tab-panel" id="tab-submissions" aria-hidden="true">
                            <div id="selectedTeamSubmissionsList"></div>
                        </div>
                        <div class="tdb-tab-panel" id="tab-files" aria-hidden="true">
                            <div style="margin-bottom: 1rem;">
                                <input type="file" id="teamFileInputPanel" multiple style="display: none;">
                                <button onclick="handleFileUploadClick()" class="tdb-btn tdb-btn-secondary tdb-btn-small">
                                    <i class="fas fa-upload"></i> Upload Files
                                </button>
                            </div>
                            <div id="teamFilesListPanel"></div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Aside Sidebar -->
        <aside class="tdb-aside" id="tdbAside">
            <!-- Quick Actions -->
            <div class="tdb-aside-section">
                <div class="tdb-aside-section-header">
                    <h3 class="tdb-aside-section-title">Quick Actions</h3>
                </div>
                <div class="tdb-quick-actions">
                    <button class="tdb-btn tdb-btn-primary" onclick="openCreateTeamModal()" id="asideNewTeamBtn">
                        <i class="fas fa-users"></i> New Team
                    </button>
                    <button class="tdb-btn tdb-btn-primary" onclick="showTeamSelectionForTask()" id="asideNewTaskBtn" style="display: none;">
                        <i class="fas fa-tasks"></i> Create Task
                    </button>
                    <button class="tdb-btn tdb-btn-success" onclick="addMemberToSelectedTeam()" id="asideAddStudentBtn" style="display: none;">
                        <i class="fas fa-user-plus"></i> Add Student
                    </button>
                </div>
            </div>

            <!-- Filters -->
            <div class="tdb-aside-section" id="filtersSection" style="display: none;">
                <div class="tdb-aside-section-header">
                    <h3 class="tdb-aside-section-title">Filters</h3>
                    <button class="tdb-collapse-btn" onclick="toggleSection('filtersSection')" aria-label="Toggle filters">
                        <i class="fas fa-chevron-up"></i>
                    </button>
                </div>
                <div class="tdb-filter-group">
                    <label class="tdb-filter-label">Risk Level</label>
                    <label class="tdb-filter-checkbox">
                        <input type="checkbox" id="filterRiskGreen" onchange="applyFilters()">
                        <span>Low Risk (Green)</span>
                    </label>
                    <label class="tdb-filter-checkbox">
                        <input type="checkbox" id="filterRiskYellow" onchange="applyFilters()">
                        <span>Medium Risk (Yellow)</span>
                    </label>
                    <label class="tdb-filter-checkbox">
                        <input type="checkbox" id="filterRiskRed" onchange="applyFilters()">
                        <span>High Risk (Red)</span>
                    </label>
                </div>
                <div class="tdb-filter-group">
                    <label class="tdb-filter-checkbox">
                        <input type="checkbox" id="filterOverdue" onchange="applyFilters()">
                        <span>Show Overdue Only</span>
                    </label>
                </div>
            </div>

            <!-- AI Insights -->
            <div class="tdb-aside-section" id="aiInsightsSection" style="display: none;">
                <div class="tdb-aside-section-header">
                    <h3 class="tdb-aside-section-title">AI Insights</h3>
                    <button class="tdb-collapse-btn" onclick="toggleSection('aiInsightsSection')" aria-label="Toggle AI insights">
                        <i class="fas fa-chevron-up"></i>
                    </button>
                </div>
                <div id="aiInsightsList"></div>
            </div>

            <!-- Recent Activity -->
            <div class="tdb-aside-section" id="recentActivitySection" style="display: none;">
                <div class="tdb-aside-section-header">
                    <h3 class="tdb-aside-section-title">Recent Activity</h3>
                    <button class="tdb-collapse-btn" onclick="toggleSection('recentActivitySection')" aria-label="Toggle recent activity">
                        <i class="fas fa-chevron-up"></i>
                    </button>
                </div>
                <div id="recentActivityList"></div>
            </div>

            <!-- Shortcuts -->
            <div class="tdb-aside-section">
                <div class="tdb-aside-section-header">
                    <h3 class="tdb-aside-section-title">Shortcuts</h3>
                </div>
                <a href="#" onclick="openTeamDashboard(selectedTeamId); return false;" class="tdb-shortcut-link" id="shortcutViewDashboard" style="display: none;">
                    <i class="fas fa-chart-line"></i> View Dashboard
                </a>
                <a href="#" onclick="openTeamManagement(selectedTeamId); return false;" class="tdb-shortcut-link" id="shortcutManageTeam" style="display: none;">
                    <i class="fas fa-cog"></i> Manage Team
                </a>
                <a href="#" onclick="exportClassData(); return false;" class="tdb-shortcut-link" id="shortcutExport" style="display: none;">
                    <i class="fas fa-download"></i> Download CSV
                </a>
            </div>
        </aside>
    </div>
    
    <!-- Create Class Modal -->
    <div id="createClassModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2><i class="fas fa-book"></i> Create New Class</h2>
                <button class="close-btn" onclick="closeModal('createClassModal')">&times;</button>
            </div>
            <form id="createClassForm">
                <div class="form-group">
                    <label for="className">Class Name *</label>
                    <input type="text" id="className" required placeholder="e.g., Computer Science 101">
                </div>
                <div class="form-group">
                    <label for="classDescription">Description</label>
                    <textarea id="classDescription" rows="3" placeholder="Brief description of the class"></textarea>
                </div>
                <div class="form-group">
                    <label for="classExpiryDate">Expiry Date (Optional)</label>
                    <input type="date" id="classExpiryDate" placeholder="Leave empty for no expiry">
                    <p style="font-size: 0.875rem; color: #6b7280; margin-top: 4px;">
                        <i class="fas fa-info-circle"></i> Set when this class should expire (e.g., end of semester)
                    </p>
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('createClassModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-check"></i> Create Class
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Create Team Modal -->
    <div id="createTeamModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2><i class="fas fa-users"></i> Create New Team</h2>
                <button class="close-btn" onclick="closeModal('createTeamModal')">&times;</button>
            </div>
            <form id="createTeamForm">
                <input type="hidden" id="teamClassId">
                <div class="form-group">
                    <label for="teamName">Team Name *</label>
                    <input type="text" id="teamName" required placeholder="e.g., Team Alpha">
                </div>
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('createTeamModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-check"></i> Create Team
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Team Management Modal -->
    <div id="teamManagementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="teamManagementTitle">Team Management</h2>
                <button class="close-btn" onclick="closeModal('teamManagementModal')">&times;</button>
            </div>
            
            <div style="margin-bottom: 30px;">
                <h3><i class="fas fa-users"></i> Team Members</h3>
                <div id="teamMembersList" style="margin: 20px 0;"></div>
                
                <form id="addMemberForm" style="display: flex; gap: 12px; margin-top: 16px;">
                    <input type="email" id="memberEmail" placeholder="Student email" style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px;" required>
                    <button type="submit" class="btn btn-primary btn-small">
                        <i class="fas fa-plus"></i> Add Student
                    </button>
                </form>
            </div>
            
            <div style="margin-bottom: 30px;">
                <h3><i class="fas fa-tasks"></i> Tasks</h3>
                <div id="teamTasksList" style="margin: 20px 0;"></div>
                <button class="btn btn-primary btn-small" onclick="showCreateTaskForm()">
                    <i class="fas fa-plus"></i> Add Task
                </button>
            </div>
            
            <div id="createTaskFormContainer" style="display: none; margin-top: 20px; padding: 20px; background: #f9fafb; border-radius: 8px;">
                <h4>Create New Task</h4>
                <form id="createTaskForm">
                    <div class="form-group">
                        <label for="taskTitle">Task Title *</label>
                        <input type="text" id="taskTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="taskDescription">Description</label>
                        <textarea id="taskDescription" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="taskDueDate">Due Date</label>
                        <input type="date" id="taskDueDate">
                    </div>
                    <div class="form-group">
                        <label for="taskAssignedTo">Assign To (Optional)</label>
                        <select id="taskAssignedTo">
                            <option value="">All team members</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <button type="submit" class="btn btn-primary btn-small">
                            <i class="fas fa-check"></i> Create Task
                        </button>
                        <button type="button" class="btn btn-secondary btn-small" onclick="hideCreateTaskForm()">Cancel</button>
                    </div>
                </form>
            </div>
            
            <!-- Team Chat Section (Collapsible) -->
            <div style="margin-bottom: 30px;" id="teamChatSectionContainer">
                <h3 style="cursor: pointer; display: flex; align-items: center; gap: 8px; user-select: none;" onclick="toggleChatSection()">
                    <i class="fas fa-comments"></i> Team Chat
                    <i class="fas fa-chevron-down" id="chatSectionCaret" style="font-size: 0.875rem; transition: transform 0.3s; transform: rotate(-90deg);"></i>
                </h3>
                <div class="chat-container" id="teamChatContainer" style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; display: none;">
                    <div id="teamChatMessages" style="height: 300px; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 12px;"></div>
                    <div style="padding: 1rem; border-top: 1px solid #e5e7eb; display: flex; gap: 8px;">
                        <input type="text" id="chatMessageInput" placeholder="Type a message..." style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px;" onkeypress="if(event.key==='Enter') sendChatMessage()">
                        <button onclick="sendChatMessage()" class="btn btn-primary btn-small">
                            <i class="fas fa-paper-plane"></i> Send
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Team Files Section -->
            <div style="margin-bottom: 30px;">
                <h3><i class="fas fa-folder"></i> Team Files</h3>
                <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 1rem;">
                    <div style="margin-bottom: 1rem;">
                        <input type="file" id="teamFileInput" multiple style="display: none;">
                        <button onclick="document.getElementById('teamFileInput').click()" class="btn btn-secondary btn-small">
                            <i class="fas fa-upload"></i> Upload Files
                        </button>
                    </div>
                    <div id="teamFilesList"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Team Dashboard Modal -->
    <div id="teamDashboardModal" class="modal">
        <div class="modal-content" style="max-width: 1200px;">
            <div class="modal-header">
                <h2 id="teamDashboardTitle">Team Dashboard</h2>
                <button class="close-btn" onclick="closeModal('teamDashboardModal')">&times;</button>
            </div>
            
            <!-- Team Stats -->
            <div style="margin-bottom: 2rem;">
                <h3><i class="fas fa-chart-bar"></i> Team Statistics</h3>
                <div id="teamStats"></div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem;">
                <!-- Progress Timeline -->
                <div>
                    <h3><i class="fas fa-stream"></i> Progress Timeline</h3>
                    <div id="teamTimeline" style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); max-height: 500px; overflow-y: auto;"></div>
                </div>
                
                <!-- Upcoming Deadlines -->
                <div>
                    <h3><i class="fas fa-clock"></i> Upcoming Deadlines</h3>
                    <div id="teamDeadlines" style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);"></div>
                    
                    <h3 style="margin-top: 2rem;"><i class="fas fa-history"></i> Recent Activity</h3>
                    <div id="teamActivity" style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); max-height: 300px; overflow-y: auto;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Submissions Modal -->
    <div id="taskSubmissionsModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 id="submissionsTaskTitle">Task Submissions</h2>
                <button class="close-btn" onclick="closeModal('taskSubmissionsModal')">&times;</button>
            </div>
            
            <div id="taskSubmissionsContent"></div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <script src="/progress-tracker.js"></script>
    
    <script>
        // Mobile menu toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const sidebar = document.getElementById('teacherSidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');

            if (mobileMenuToggle && sidebar && sidebarOverlay) {
                // Toggle sidebar on mobile menu button click
                mobileMenuToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('mobile-open');
                    sidebarOverlay.classList.toggle('active');
                    
                    // Change icon
                    const icon = this.querySelector('i');
                    if (sidebar.classList.contains('mobile-open')) {
                        icon.classList.remove('fa-bars');
                        icon.classList.add('fa-times');
                    } else {
                        icon.classList.remove('fa-times');
                        icon.classList.add('fa-bars');
                    }
                });

                // Close sidebar when overlay is clicked
                sidebarOverlay.addEventListener('click', function() {
                    sidebar.classList.remove('mobile-open');
                    sidebarOverlay.classList.remove('active');
                    
                    const icon = mobileMenuToggle.querySelector('i');
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                });

                // Close sidebar when clicking links inside (for mobile)
                const sidebarLinks = sidebar.querySelectorAll('a, .class-card, .btn');
                sidebarLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        if (window.innerWidth <= 600) {
                            setTimeout(() => {
                                sidebar.classList.remove('mobile-open');
                                sidebarOverlay.classList.remove('active');
                                
                                const icon = mobileMenuToggle.querySelector('i');
                                icon.classList.remove('fa-times');
                                icon.classList.add('fa-bars');
                            }, 200);
                        }
                    });
                });
            }
        });
    </script>
    
    <!-- Team Selection Modal for Task Creation -->
    <div id="teamSelectionModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>Select Team for Task</h2>
                <button class="close-btn" onclick="closeModal('teamSelectionModal')">&times;</button>
            </div>
            <div style="padding: 1rem 0;">
                <p style="color: #6b7280; margin-bottom: 1rem;">Choose a team to create a task for:</p>
                <div id="teamSelectionList" style="max-height: 400px; overflow-y: auto;">
                    <p style="text-align: center; color: #6b7280; padding: 2rem;">Loading teams...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Slide-Over -->
    <div class="chat-slide-over" id="chatSlideOver" aria-hidden="true">
        <div class="chat-slide-over-backdrop" onclick="closeChatSlideOver()"></div>
        <div class="chat-slide-over-content">
            <div class="chat-slide-over-header">
                <h2><i class="fas fa-comments"></i> Team Chat</h2>
                <button class="chat-slide-over-close" onclick="closeChatSlideOver()" aria-label="Close Chat">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="chat-slide-over-body">
                <!-- Chat messages container - will reuse DOM from original -->
                <div id="chatSlideOverMessages" style="flex: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 12px;"></div>
            </div>
            <div class="chat-slide-over-footer">
                <div style="display: flex; gap: 8px; padding: 1rem;">
                    <input type="text" id="chatSlideOverInput" placeholder="Type a message..." style="flex: 1; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px;" onkeypress="if(event.key==='Enter') sendChatMessageFromSlideOver()">
                    <button onclick="sendChatMessageFromSlideOver()" class="btn btn-primary btn-small">
                        <i class="fas fa-paper-plane"></i> Send
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="/teacher-dashboard.js"></script>
</body>
</html>
